#include "functions.h"

// 맵 그리기
int iMap1[20][44] =
{
	{9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9 },
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,9},
	{9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9}
};

/////////////////////////////////////////////////////////////
// A가 B를 공격하는 함수
/////////////////////////////////////////////////////////////
int AttackAtoB(int iAtkA, int iDefB, int iHpB, int iCurY)
{
	int iDamage = 0;
	// 데미지 계산
	iDamage = iDefB - iAtkA;
	if (iDamage < 0)
	{
		iHpB += iDamage;

		gotoXY(2, iCurY + 1);
		printf("피해를 %d 입혔습니다.", iDamage);
		gotoXY(2, iCurY + 2);
		printf("남은 체력 : %d", iHpB);
	}
	else
	{
		gotoXY(2, iCurY + 1);
		printf("공격에 실패 하셨습니다.");
	}
	return iHpB;
}

/////////////////////////////////////////////////////////////
// Random 함수(확률 값을 반환하는 함수)
/////////////////////////////////////////////////////////////
int RPGRandom(int iPercent)
{
	int iRand = 0;
	srand(time(NULL));
	iRand = rand() % iPercent;

	return iRand;
}

/////////////////////////////////////////////////////////////
// X, Y로 이동하는 함수
/////////////////////////////////////////////////////////////
void gotoXY(int x, int y)
{
	COORD Cursor;
	Cursor.X = x;
	Cursor.Y = y;
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), Cursor);
}

void setColor(int forground, int background)
{
	HANDLE consoleHandle = GetStdHandle(STD_OUTPUT_HANDLE);
	int code = forground + background * 16;
	SetConsoleTextAttribute(consoleHandle, code);
}

/////////////////////////////////////////////////////////////
// 메뉴 화면을 지워주는 함수
/////////////////////////////////////////////////////////////
void ClearMenu()
{
	// 메뉴 지우기
	gotoXY(50, 31);
	printf("                                 ");
	gotoXY(50, 32);
	printf("                                 ");
	gotoXY(50, 33);
	printf("                                 ");
	gotoXY(50, 34);
	printf("                                 ");
}

/////////////////////////////////////////////////////////////
// 메인 화면을 지워주는 함수
/////////////////////////////////////////////////////////////
void ClearMainScreen()
{
	gotoXY(30, 15);
	printf("                      ");
}

/////////////////////////////////////////////////////////////
// Text 화면을 지워주는 함수
/////////////////////////////////////////////////////////////
void ClearTextBox()
{
	gotoXY(2, 32);
	printf("                                       ");
	gotoXY(2, 33);
	printf("                                       ");
	gotoXY(2, 34);
	printf("                                       ");
	gotoXY(2, 35);
	printf("                                       ");
	gotoXY(2, 36);
	printf("                                       ");
	gotoXY(2, 37);
	printf("                                       ");
}

/////////////////////////////////////////////////////////////
// 메인 Screen 라인을 그리는 함수
/////////////////////////////////////////////////////////////
void DrawScreenLine()
{
	// 위쪽 라인
	gotoXY(0, 0);
	printf("\t\t\t    스테이지 1\n");
	printf("****************************************************************");
	// 아래쪽 라인
	gotoXY(0, 30);
	printf("****************************************************************");
}

/////////////////////////////////////////////////////////////
// 메인 Screen에 Map을 그리는 함수
/////////////////////////////////////////////////////////////
void DrawMap()
{
	int iIndexX = 0, iIndexY = 0;

	for (iIndexY = 0; iIndexY < 20; iIndexY++)
	{
		gotoXY(6, 6 + iIndexY);
		for (iIndexX = 0; iIndexX < 44; iIndexX++)
		{
			if (iMap1[iIndexY][iIndexX] == 9)
			{
				setColor(white, white); // 테두리
				printf("#"); // 테두리
			}
			else if (iMap1[iIndexY][iIndexX] == 7)
			{
				setColor(cyan, black);
				printf("+"); // 몬스터
			}
			else if (iMap1[iIndexY][iIndexX] == 3)
			{
				setColor(lightgreen, lightgreen);
				printf("#"); // 벽
			}
			else
			{
				setColor(black, black);
				printf(" ");
			}
		}
		printf("\n");
	}
	setColor(white, black);
	//Sleep(3000);
}

/////////////////////////////////////////////////////////////
// 메인 Screen에 Map을 지우는 함수
/////////////////////////////////////////////////////////////
void ClearMap()
{

	int iIndexX = 0, iIndexY = 0;

	for (iIndexY = 0; iIndexY < 20; iIndexY++)
	{
		gotoXY(6, 6 + iIndexY);
		for (iIndexX = 0; iIndexX < 44; iIndexX++)
		{
			printf(" ");
		}
		printf("\n");
	}

}

/////////////////////////////////////////////////////////////
// 현재 위치와 map의 이벤트 위치를 비교하여
// Event 발생 여부를 알려주는 함수
/////////////////////////////////////////////////////////////
int GetEventForMap(int iCurrentX, int iCurrentY)
{
	int iEventOk = -1;
	if (iMap1[iCurrentY][iCurrentX] == 7)
	{
		iEventOk = 0;
	}
	else if (iMap1[iCurrentY][iCurrentX] == 3)
	{
		iEventOk = 0;
	}
	return iEventOk;
}